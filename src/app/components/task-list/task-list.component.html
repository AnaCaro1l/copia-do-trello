<p-toast />
<p-confirmDialog />
<div
  *ngIf="isOpen()"
  class="bg-gray-900 rounded-lg min-w-[272px] cursor-pointer shadow-lg hover:shadow-2xl hover:bg-opacity-95 transition-shadow"
>
  <div class="justify-between flex p-4 items-center">
    <div class="text-white">{{ taskList?.title }}</div>
    <div>
      <button
        (click)="toggleOpen()"
        class="group text-white hover:bg-white/10 transition-colors p-2 rounded-full"
      >
        <lucide-angular
          [img]="minimize"
          color="white"
          size="18"
        ></lucide-angular>
      </button>
      <button
        (click)="menu.toggle($event)"
        class="group text-white hover:bg-white/10 transition-colors p-2 rounded-full"
      >
        <lucide-angular
          [img]="ellipsis"
          color="white"
          size="18"
        ></lucide-angular>
      </button>
      <p-menu #menu [model]="items" [popup]="true" />
    </div>
  </div>
  <div
    class="px-3 gap-2 flex flex-col min-h-[50px] py-2"
    cdkDropList
    [id]="dropListId"
    [cdkDropListData]="taskList?.cards ?? []"
    [cdkDropListConnectedTo]="connectedDropLists"
    (cdkDropListDropped)="drop($event)"
  >
    @for (task of cards; track task.id) {
    <app-task [task]="task"></app-task>
    }
    <div
      *ngIf="(cards?.length ?? 0) === 0"
      class="text-white/50 text-sm h-[40px] border border-dashed border-white/20 rounded-md p-3 text-center select-none"
    >
      Solte tarefas aqui
    </div>
  </div>
  <div class="p-3">
    <div
      [ngClass]="isEditMode() ? 'bg-white/10' : ''"
      class="flex gap-3 p-1 rounded-lg shadow-lg cursor-pointer hover:bg-white/10 transition-colors min-w-[200px]"
    >
      <div
        *ngIf="!isEditMode()"
        class="flex gap-1 items-center"
        (click)="AddCard()"
      >
        <lucide-angular [img]="plus" color="white" size="18"></lucide-angular>

        <div class="text-white p-1">Adicionar card</div>
      </div>
      <form
        [formGroup]="formTask"
        (ngSubmit)="Submit()"
        *ngIf="isEditMode()"
        class="flex gap-2 items-center px-1 w-full justify-between"
      >
        <input
          type="text"
          formControlName="title"
          class="text-white bg-transparent p-1 rounded-lg w-40 outline-none border-none"
          placeholder="Título da lista"
        />
        <div class="flex gap-1 items-center">
          <button type="submit">
            <lucide-angular
              [img]="check"
              color="white"
              size="20"
              class="hover:bg-white/15 rounded-full transition-colors"
            ></lucide-angular>
          </button>
          <button (click)="close()" type="button">
            <lucide-angular
              [img]="x"
              color="red"
              size="20"
              class="hover:bg-white/15 rounded-full transition-colors"
            ></lucide-angular>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div *ngIf="!isOpen()" class="w-15 [writing-mode:vertical-rl]">
  <div class="bg-gray-900 rounded-lg p-2 flex items-center">
    <button
      (click)="toggleOpen()"
      class="group text-white hover:bg-white/10 transition-colors p-2 rounded-full"
    >
      <lucide-angular [img]="maximize" color="white" size="18"></lucide-angular>
    </button>
    <div class="text-white py-2">{{ taskList?.title || "Sem nome" }}</div>
  </div>
</div>

<p-dialog header="Editar Lista" [(visible)]="visible">
  <ng-template pTemplate="content">
    <form [formGroup]="formTaskEdit" class="flex flex-col gap-3">
      <input
        formControlName="title"
        type="text"
        placeholder="Título da Lista"
        class="p-2 rounded-lg bg-transparent border border-gray-700 text-white w-full placeholder:!text-white/40 focus:outline-none"
      />
    </form>
  </ng-template>
  <ng-template pTemplate="footer">
    <button
      mat-flat-button
      color="warn"
      class="mr-2"
      (click)="this.visible = false"
    >
      Cancelar
    </button>
    <button
      mat-flat-button
      [disabled]="formTaskEdit.invalid"
      (click)="onEditList()"
    >
      Salvar
    </button>
  </ng-template>
</p-dialog>
