<header class="w-full flex p-1 border-b border-white/10">
  <div class="flex items-center gap-2 w-full justify-between">
    <div class="flex items-center">
      <button
        *ngIf="showMenuButton"
        mat-icon-button
        (click)="toggleMenu()"
        class="group text-white hover:bg-white/10 transition-colors"
        [matTooltip]="isMenuOpen ? 'Fechar menu' : 'Abrir menu'"
      >
        <lucide-angular
          [img]="isMenuOpen ? panelLeftClose : panelLeftOpen"
          color="white"
          size="20"
        ></lucide-angular>
      </button>

      <button
        *ngIf="showHomeButton"
        mat-icon-button
        (click)="goToHome()"
        class="group text-white hover:bg-white/10 transition-colors"
        aria-label="Home"
        matTooltip="Home"
      >
        <lucide-angular [img]="house" color="white" size="20"></lucide-angular>
      </button>
    </div>
    <div class="flex items-center">
      @if (invitesUnread.length === 0) {
      <button
        (click)="op2.toggle($event)"
        mat-icon-button
        class="group text-white hover:bg-white/10 transition-colors"
        aria-label="Notificações"
        matTooltip="Notificações"
      >
        <lucide-angular [img]="bell" color="white" size="20"></lucide-angular>
      </button>
      } @else {
      <button
        (click)="op2.toggle($event)"
        class="group mt-2 rounded-full p-1 px-2 text-white hover:bg-white/10 transition-colors"
        aria-label="Notificações"
        matTooltip="Notificações"
      >
        <i
          class="pi pi-bell text-xl p-1"
          pBadge
          value="{{ invitesUnread.length }}"
        ></i>
      </button>
      }

      <p-avatar
        (click)="op.toggle($event)"
        label="{{ getCurrentUser()?.name.charAt(0) | uppercase }}"
        styleClass="mr-4 ml-2 cursor-pointer"
        matTooltip="Perfil"
        [style]="{ 'background-color': '#dee9fc', color: '#1a2551' }"
        shape="circle"
      />
    </div>
  </div>
</header>

<p-overlayPanel #op>
  <div class="p-2 w-48">
    <div class="flex flex-col gap-3">
      <div class="flex items-center gap-3">
        <p-avatar
          label="{{ getCurrentUser()?.name.charAt(0) | uppercase }}"
          styleClass="mr-2"
          [style]="{ 'background-color': '#dee9fc', color: '#1a2551' }"
          shape="circle"
        />
        <div class="flex flex-col">
          <span class="text-sm font-semibold">{{
            getCurrentUser()?.name
          }}</span>
          <span class="text-xs text-gray-400">{{
            getCurrentUser()?.email
          }}</span>
        </div>
      </div>
      <button
        mat-flat-button
        color="primary"
        class="w-full text-left"
        (click)="EditProfile()"
      >
        Editar Perfil
      </button>
      <button
        mat-flat-button
        color="warn"
        class="w-full text-left"
        (click)="logout()"
      >
        Sair
      </button>
    </div>
  </div>
</p-overlayPanel>

<p-overlayPanel #op2 [showCloseIcon]="true" [style]="{ width: '300px' }">
  <p class="justify-start">Notificações</p>
  <p-tabView>
    <p-tabPanel header="Todos">
      <div
        *ngFor="let invite of invites"
        class="p-1 border-b border-t border-gray-700 w-full gap-2 flex flex-col"
      >
        <p class="text-sm">
          {{ invite.sender.name }} convidou você para o workspace
          {{ invite.workspace.name }}
        </p>
        <div *ngIf="invite.status === 'pending'" class="flex gap-1">
          <button
            mat-flat-button
            color="primary"
            (click)="acceptInvite(invite.id)"
          >
            Aceitar
          </button>
          <button
            mat-flat-button
            color="warn"
            (click)="declineInvite(invite.id)"
          >
            Recusar
          </button>
        </div>
        <p class="text-xs text-gray-400">
          {{ invite.createdAt | date : "short" }}
        </p>
      </div>
    </p-tabPanel>
    <p-tabPanel header="Não lidos">
      <div
        *ngFor="let invite of invitesUnread"
        class="p-1 border-b border-t border-gray-700 w-full gap-2 flex flex-col"
      >
        <p class="text-sm">
          {{ invite.sender.name }} convidou você para o workspace
          {{ invite.workspace.name }}
        </p>
        <div class="flex gap-1">
          <button
            mat-flat-button
            color="primary"
            (click)="acceptInvite(invite.id)"
          >
            Aceitar
          </button>
          <button
            mat-flat-button
            color="warn"
            (click)="declineInvite(invite.id)"
          >
            Recusar
          </button>
        </div>
        <p class="text-xs text-gray-400">
          {{ invite.createdAt | date : "short" }}
        </p>
      </div>
    </p-tabPanel>
    <p-tabPanel header="Lidos">
      <div
        *ngFor="let invite of invitesRead"
        class="p-1 border-b border-t border-gray-700 w-full gap-2 flex flex-col"
      >
        <p class="text-sm">
          {{ invite.sender.name }} convidou você para o workspace
          {{ invite.workspace.name }}
        </p>
        <p class="text-xs text-gray-400">
          {{ invite.createdAt | date : "short" }}
        </p>
      </div>
    </p-tabPanel>
  </p-tabView>

  <div class=""></div>
</p-overlayPanel>
